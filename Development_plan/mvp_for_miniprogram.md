# 小程序平台MVP技术栈规划

## 技术选型
- **开发框架**: 微信小程序原生开发 / uni-app (跨平台小程序开发框架)
- **开发语言**: JavaScript / TypeScript (提供类型安全)
- **组件库**: WeUI (微信官方设计规范组件库) / vant-weapp (有赞轻量级组件库)
- **地图**: 微信小程序内置地图组件 (基于腾讯地图)
- **状态管理**: Mobx (轻量级状态管理) / Vuex (uni-app中使用)
- **云服务**: 微信云开发 (数据库、云函数、存储)
- **实时通信**: WebSocket (微信小程序支持) + 云开发实时数据库

## 目录结构 (微信小程序原生)
```
/miniprogram
├── /api                 # 云开发API调用
├── /components          # 可复用组件
│   ├── user-avatar      # 用户头像组件
│   ├── chat-bubble      # 聊天气泡组件
│   └── broadcast-card   # 广播消息卡片
├── /pages               # 主要页面
│   ├── map              # 地图主页面
│   │   ├── map.js
│   │   ├── map.wxml
│   │   ├── map.wxss
│   │   └── map.json
│   └── chat             # 聊天对话页面
│       ├── chat.js
│       ├── chat.wxml
│       ├── chat.wxss
│       └── chat.json
├── /utils               # 工具函数
│   ├── distance.js      # 距离计算
│   └── anonymous.js     # 匿名ID生成
├── /store               # 状态管理
├── app.js               # 应用入口
├── app.json             # 全局配置
└── app.wxss             # 全局样式
```

## 目录结构 (uni-app方案)
```
/src
├── /api                 # 云开发API调用
├── /components          # 可复用组件
│   ├── UserAvatar.vue   # 用户头像组件
│   ├── ChatBubble.vue   # 聊天气泡组件
│   └── BroadcastCard.vue # 广播消息卡片
├── /pages               # 主要页面
│   ├── map/index.vue    # 地图主页面
│   └── chat/index.vue   # 聊天对话页面
├── /store               # 状态管理
│   ├── index.js
│   └── modules/         # 各功能模块
├── /utils               # 工具函数
│   ├── distance.js      # 距离计算
│   └── anonymous.js     # 匿名ID生成
├── App.vue              # 应用入口
├── main.js              # 主入口
└── pages.json           # 页面配置
```

## 小程序平台优势
1. **低门槛获取用户**: 无需下载安装APP，扫码即用，减少用户获取成本
2. **位置服务**: 微信小程序内置精准定位能力，无需额外集成SDK
3. **云开发**: 微信提供一站式后端服务，无需自建服务器
4. **社交分享**: 可利用微信社交关系链快速传播
5. **开发成本低**: 开发周期短，团队规模小，适合MVP验证

## 小程序平台限制及解决方案
1. **后台运行限制**: 
   - 问题: 小程序退到后台后定位功能暂停
   - 解决: 使用定时提醒，鼓励用户保持前台运行

2. **通信限制**: 
   - 问题: WebSocket连接数限制
   - 解决: 使用云开发实时数据库监听，优化消息推送策略

3. **存储限制**:
   - 问题: 本地存储容量有限
   - 解决: 聊天记录云端存储，本地仅保留必要数据

## MVP功能实现方案
1. **基础定位与可见性**:
   - 使用微信小程序地图组件显示当前位置
   - 通过云数据库存储和查询附近用户位置信息
   - 前端计算用户间距离，显示100米范围内的用户头像

2. **最简聊天交互**:
   - 云开发实时数据库存储消息
   - 建立临时会话ID (user1_user2)，用于消息关联
   - 设置24小时过期时间，自动清理历史消息

3. **基础防骚扰机制**:
   - 一键举报功能通过云函数处理
   - 本地存储举报记录，云端同步

4. **极简UI与流程**:
   - 单页设计：地图主界面 + 聊天浮窗
   - 使用微信授权登录，无需额外注册

## 开发周期
- **第1周**: 基础定位 + 地图显示用户头像
- **第2周**: 云开发集成 + 1v1文字聊天
- **第3周**: 广播功能 + 举报按钮 + 基础测试
- **总计**: 3周开发 + 1周灰度测试

## 成本估算
- **开发资源**: 1名全栈开发者(微信小程序) + 1名UI设计师，3周工作量
- **云开发**: 微信云开发基础版免费额度足够MVP阶段使用
- **总成本**: 显著低于原生APP开发成本，适合快速验证产品概念 